<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Hello</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.1/normalize.min.css"
    integrity="sha512-NhSC1YmyruXifcj/KFRWoC561YpHpc5Jtzgvbuzx5VozKpWvQ+4nXhPdFgmx8xqexRcpAglTj9sIBWINXa8x5w=="
    crossorigin="anonymous" referrerpolicy="no-referrer" />
  <style>
    body {
      background-color: black;
      color: white;
      touch-action: manipulation;
      /* to prevent double tap zoom on IOS */
    }

    svg {
      display: inline-block;
      vertical-align: middle;
    }

    button {
      width: 50px;
      height: 50px;
      line-height: 45px;
      border: 3px solid yellow;
      border-radius: 5px;
      background-color: blue;
      color: white;
      margin: 0px 15px;
      font-size: 20px;
      text-align: center;
      font-weight: 800;
      padding: 0;
      vertical-align: middle;
    }

    button:hover {
      font-weight: bolder;
      cursor: pointer;
      color: white;
      transform: scale(1.1);
    }

    button:focus {
      font-weight: bolder;
      background-color: red;
      color: white;
    }

    .play {
      background-color: yellow;
      color: blue;
      font-size: 38px;
    }

    .btn-green {
      background-color: lightgreen;
    }

    .fs35 {
      font-size: 35px;
    }

    .btn-orange {
      background-color: orange;
    }

    .btn-coral {
      background-color: coral;
    }

    .button-container {
      margin: auto;
      text-align: center;
    }
  </style>
  <script src="https://www.youtube.com/iframe_api"></script>
</head>


<body>
  <div id="player"></div>

  <script>
    var player;
    const PLAYER_STATES = {
      UN_STARTED: -1,
      ENDED: 0,
      PLAYING: 1,
      PAUSED: 2,
      BUFFERING: 3,
      VIDEO_CUED: 5,
    }
    var aPosition = 0;
    var bPosition = 0;
    var isABMode = false;
    function isHorizontalScreen() { return screen.orientation && screen.orientation.angle === 90; }
    function getWidthHeight() {
      let playerHeight = window.innerHeight || window.document.documentElement.clientHeight;
      let playerWidth = '100%';
      if (isHorizontalScreen()) {
        playerHeight = playerHeight - 80;
      } else {
        playerHeight = playerHeight - 200;
      }
      return { playerWidth, playerHeight };
    }
    function updatePlayerSize() {
      if (!player) return;
      const bestRatioHeight = window.innerWidth * 9 / 16;
      const calculatedHeight = window.innerHeight - 200 < bestRatioHeight ? window.innerHeight - 200 : bestRatioHeight;
      player.setSize(window.innerWidth, window.innerWidth * 9 / 16);
    }

    window.addEventListener("orientationchange", updatePlayerSize, false);
    window.addEventListener("resize", updatePlayerSize, false);
    const { playerWidth, playerHeight } = getWidthHeight();
    let videoId = '7WB6tqKuJmk';
    let defaultSeek = 120;
    let saveData = localStorage.getItem('SAVE');
    if (saveData) {
      saveData = JSON.parse(saveData);
      videoId = saveData.video_id;
      defaultSeek = saveData.currentTime;
    }

    function onYouTubeIframeAPIReady() {
      player = new YT.Player('player', {
        height: playerHeight,
        width: playerWidth,
        videoId,
        playerVars: {
          playsinline: 0,
          listType: 'playlist',
          list: "PL-OcaCMv_LvvOshnnfuZfk4XoG7E7Ryyn",
          modestbranding: 1, // to hide Youtube logo
          rel: 0
        },
        events: {
          'onReady': onPlayerReady,
          'onStateChange': onPlayerStateChange
        },
        controls: 0,
        autoplay: 0,
        loop: 0
      });
    }

    function onPlayerReady(event) {
      player.seekTo(defaultSeek);
    }

    function onPlayerStateChange(event) {
      console.log('event', event.target.getCurrentTime())
    }
    function stopVideo() {
      player.stopVideo();
    }

    function changeTime(seconds) {
      player.seekTo(player.getCurrentTime() + seconds);
    }
    function pause() {
      player.pauseVideo();
    }

    function play() {
      const playBtn = document.getElementById("playBtn");
      if (player.getPlayerState() !== PLAYER_STATES.PLAYING) {
        player.playVideo();
      } else {
        player.pauseVideo();
      }
    }

    function rePlayABMode() {
      if (aPosition > 0 && bPosition > 0 && aPosition < bPosition && player.getCurrentTime() > bPosition) {
        player.seekTo(aPosition);
      }
    }

    let intervalJob;
    function setA() { aPosition = player.getCurrentTime(); }
    function changeA(amount) { if (aPosition > 0) aPosition += amount; }
    function changeB(amount) { if (bPosition > 0) bPosition += amount; }

    function setB() {
      if (isABMode === false) {
        intervalJob = setInterval(rePlayABMode, 1000);
      }
      isABMode = true;
      bPosition = player.getCurrentTime();
    }

    function cancelABMode() {
      clearInterval(intervalJob);
      isABMode = false;
    }

    function save() {
      if (player) {
        const { video_id } = player.getVideoData();
        const currentTime = player.getCurrentTime();
        localStorage.setItem('SAVE', JSON.stringify({ video_id, currentTime }));
      }
    }

    function changeSpeed(percent) {
      if (player) {
        if (!percent) player.setPlaybackRate(1);
        if (player.getPlaybackRate() + percent < 0) return;
        player.setPlaybackRate(player.getPlaybackRate() + percent);
      }
    }

  </script>
  <div class="button-container">
    <button class="btn-green fs35" onclick="save()">üíæ</button>
    <button onclick="changeTime(-60)">-60</button>
    <button onclick="changeTime(-10)">-10</button>
    <button onclick="changeTime(-5)">-5</button>
    <button onclick="changeTime(-3)">-3</button>
    <!-- <button id="playBtn" onclick="play()" class="play">
      <svg height="100%" version="1.1" viewBox="0 0 36 36" width="100%">
        <use class="ytp-svg-shadow" xlink:href="#ytp-id-46"></use>
        <path class="ytp-svg-fill" d="M 12,26 18.5,22 18.5,14 12,10 z M 18.5,22 25,18 25,18 18.5,14 z" id="ytp-id-46">
        </path>
      </svg>
    </button> -->
    <button id="playBtn" onclick="play()" class="play">üç≠</button>
    <!-- <button onclick="pause()" class="play">
      <svg height="100%" version="1.1" viewBox="0 0 36 36" width="100%">
        <use class="ytp-svg-shadow" xlink:href="#ytp-id-61"></use>
        <path class="ytp-svg-fill" d="M 12,26 16,26 16,10 12,10 z M 21,26 25,26 25,10 21,10 z" id="ytp-id-61"></path>
      </svg>
    </button> -->
    <button onclick="changeTime(3)">+3</button>
    <button onclick="changeTime(5)">+5</button>
    <button onclick="changeTime(10)">+10</button>
    <button onclick="changeTime(60)">+60</button>
  </div>
  <br />
  <div class="button-container">
    <button class="btn-green fs35" onclick="changeSpeed(-0.2)">‚Äî</button>
    <button class="btn-green" onclick="changeSpeed()">0</button>
    <button class="btn-green fs35" onclick="changeSpeed(+0.2)">+</button>

    <button class="btn-coral" onclick="setA()">A</button>
    <button class="btn-orange" onclick="changeA(-0.3)">A-</button>
    <button class="btn-orange" onclick="changeA(0.3)">A+</button>
    <button class="btn-coral" onclick="setB()">B</button>
    <button class="btn-orange" onclick="changeB(-0.3)">B-</button>
    <button class="btn-orange" onclick="changeB(0.3)">B+</button>
    <button onclick="cancelABMode()" class="fs35">üí´</button>
  </div>
</body>

</html>